<div class="w-full max-w-4xl mx-auto">
  <div class="mb-4">
    <% case @return_to %>
    <% when 'income_events' %>
      <%= link_to income_events_path,
            class: "inline-flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-700 p-3 rounded-lg transition-colors min-h-[44px] min-w-[44px]",
            title: "Back to Money In" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      <% end %>
    <% else %>
      <%= link_to dashboard_path,
            class: "inline-flex items-center justify-center bg-gray-100 hover:bg-gray-200 text-gray-700 p-3 rounded-lg transition-colors min-h-[44px] min-w-[44px]",
            title: "Return to Dashboard" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
      <% end %>
    <% end %>
  </div>
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-900">Set Up Money In</h1>
    <%= link_to "Add new money in", new_income_template_path(return_to: @return_to),
          class: "bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium",
          title: "Add a new money in source" %>
  </div>

  <p class="text-gray-600 mb-6">
    Create money in sources for your regular income. The system will automatically create income events each month based on frequency and due dates, so you only need to set this up once.
  </p>

  <% if @income_templates.any? %>
    <div class="space-y-4">
      <% @income_templates.each do |income| %>
        <div class="bg-white shadow rounded-lg p-6 flex justify-between items-center hover:shadow-md transition-shadow">
          <div class="flex-1">
            <h3 class="text-lg font-semibold text-gray-900 mb-2"><%= income.name %></h3>
            <div class="flex flex-wrap gap-3 text-sm text-gray-600">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                <%= income.frequency.humanize %>
              </span>
              <% if income.estimated_amount.present? && income.estimated_amount > 0 %>
                <span class="text-gray-700">
                  <strong><%= number_to_currency(income.estimated_amount) %></strong> estimated
                </span>
              <% end %>
              <% if income.due_date.present? %>
                <span class="text-gray-600">
                  Due: <%= income.due_date.strftime("%B %d") %>
                </span>
              <% end %>
              <span class="text-gray-600">
                <%= income.auto_create? ? "âœ“ Auto-create events" : "Manual only" %>
              </span>
            </div>
          </div>
          <div class="flex gap-3 ml-4">
            <%= link_to edit_income_template_path(income, return_to: @return_to), 
                  class: "bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg transition-colors min-h-[44px] min-w-[44px] inline-flex items-center justify-center",
                  title: "Edit this money in source" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
              </svg>
            <% end %>
            <%= button_to income_template_path(income, return_to: @return_to), method: :delete,
                  data: { confirm: "Turn off this income source? It will stop creating events in new months but can be turned back on later." },
                  class: "bg-red-600 hover:bg-red-700 text-white p-3 rounded-lg transition-colors min-h-[44px] min-w-[44px] inline-flex items-center justify-center",
                  title: "Turn off this money in source" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-white shadow rounded-lg p-12 text-center">
      <p class="text-gray-500 text-lg mb-4">No money in sources yet.</p>
      <p class="text-gray-400 mb-6">Create your first money in source to start tracking expected income!</p>
      <%= link_to "Add your first money in source", new_income_template_path(return_to: @return_to),
            class: "bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors font-medium inline-block",
            title: "Create your first money in source" %>
    </div>
  <% end %>

  <% if @inactive_income_templates.any? %>
    <div class="mt-20 pt-8 border-t border-gray-200">
      <h2 class="text-2xl font-bold text-gray-700 mb-4">Turned Off Income Sources</h2>
      <p class="text-gray-500 text-sm mb-6">These income sources are disabled and won't create events in new monthly budgets.</p>
      <div class="space-y-4">
        <% @inactive_income_templates.each do |income| %>
          <div class="bg-gray-50 shadow rounded-lg p-6 flex justify-between items-center border border-gray-200">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-gray-600 mb-2"><%= income.name %></h3>
              <div class="flex flex-wrap gap-3 text-sm text-gray-500">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-200 text-gray-600">
                  <%= income.frequency.humanize %>
                </span>
                <% if income.estimated_amount.present? && income.estimated_amount > 0 %>
                  <span class="text-gray-500">
                    <strong><%= number_to_currency(income.estimated_amount) %></strong> estimated
                  </span>
                <% end %>
                <span class="text-gray-500 italic">Turned off</span>
              </div>
            </div>
            <div class="flex gap-3 ml-4">
              <%= button_to "Turn on", reactivate_income_template_path(income, return_to: @return_to), method: :patch,
                    class: "bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium",
                    title: "Turn on this money in source" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

