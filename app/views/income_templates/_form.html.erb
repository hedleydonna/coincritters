<%= form_with model: @income_template, local: true, class: "space-y-6 max-w-2xl bg-white shadow rounded-lg p-8" do |f| %>
  <%= hidden_field_tag :return_to, @return_to if @return_to.present? %>
  <% if @income_template.errors.any? %>
    <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
      <h3 class="text-red-800 font-semibold mb-2">
        <%= pluralize(@income_template.errors.count, "error") %> prevented this income source from being saved:
      </h3>
      <ul class="list-disc list-inside text-red-700 space-y-1">
        <% @income_template.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div>
    <%= f.label :name, "Income Source Name", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.text_field :name, 
          class: "w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500", 
          placeholder: "e.g. Salary, Side gig, Child support" %>
    <p class="mt-1 text-sm text-gray-500">A descriptive name for this income source</p>
  </div>

  <div>
    <%= f.label :frequency, "Frequency", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.select :frequency, 
          options_for_select([
            ["Monthly", "monthly"], 
            ["Bi-weekly", "bi_weekly"],
            ["Weekly", "weekly"],
            ["Irregular", "irregular"]
          ], @income_template.frequency || "monthly"),
          {}, 
          class: "w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500" %>
    <p class="mt-1 text-sm text-gray-500">How often you receive this income</p>
  </div>

  <div>
    <%= f.label :due_date, "Due Date", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <%= f.date_field :due_date, 
          class: "w-full border border-gray-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-green-500 focus:border-green-500" %>
    <p class="mt-1 text-sm text-gray-500">
      <% if @income_template.new_record? %>
        Required. The date you typically receive this income (used to calculate how many events per month).
      <% else %>
      Required if auto-create is enabled. The date you typically receive this income (used to calculate how many events per month).
      <% end %>
      <br>
      <strong>Examples:</strong> Weekly on Fridays → set due_date to any Friday. Bi-weekly on the 1st and 15th → set due_date to the 1st.
    </p>
  </div>

  <div>
    <%= f.label :estimated_amount, "Estimated Amount", class: "block text-sm font-medium text-gray-700 mb-2" %>
    <div class="relative">
      <span class="absolute left-3 top-2 text-gray-500">$</span>
      <%= f.number_field :estimated_amount, 
            step: "0.01", 
            min: "0",
            class: "w-full border border-gray-300 rounded-lg px-4 py-2 pl-8 focus:ring-2 focus:ring-green-500 focus:border-green-500" %>
    </div>
    <p class="mt-1 text-sm text-gray-500">The estimated amount you typically receive (you can override the actual amount when logging income)</p>
  </div>


  <div class="flex gap-4 pt-4 pb-8">
    <%= f.submit @income_template.new_record? ? "Create Money In Source" : "Update", 
          class: "bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium cursor-pointer" %>
    <%= link_to "Cancel", @return_to == 'money_map' ? "#{money_map_path}?scroll_to=money-in-section" : income_templates_path(return_to: @return_to), 
          class: "bg-gray-200 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-300 transition-colors font-medium" %>
  </div>
<% end %>

