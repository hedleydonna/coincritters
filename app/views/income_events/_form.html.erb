<% if income_event.errors.any? %>
  <div class="bg-red-50 border border-red-200 rounded-lg p-4 mb-6">
    <h3 class="text-red-800 font-semibold mb-2">
      <%= pluralize(income_event.errors.count, "error") %> prevented this income from being saved:
    </h3>
    <ul class="list-disc list-inside text-red-700 space-y-1">
      <% income_event.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%# Amount field: Always show - pre-filled with estimated amount for template-based income %>
<div>
  <%= form.label :actual_amount, "Amount Received", class: "block text-sm font-medium text-gray-700 mb-2" do %>
    Amount Received <% if income_event.income_template_id.nil? %><span class="text-red-500">*</span><% end %>
  <% end %>
  <div class="relative">
    <span class="absolute left-3 top-2 text-gray-500 text-lg">$</span>
    <% if income_event.income_template_id.present? && income_event.actual_amount.to_f == 0 %>
      <%# Pre-fill with estimated amount for template-based income that hasn't been received yet %>
      <%= form.number_field :actual_amount, 
            value: income_event.income_template.estimated_amount,
            step: "0.01", 
            min: "0",
            placeholder: number_to_currency(income_event.income_template.estimated_amount),
            required: false,
            class: "w-full px-4 py-3 pl-8 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-full" %>
      <p class="mt-1 text-sm text-gray-500">
        Pre-filled with expected amount (<%= number_to_currency(income_event.income_template.estimated_amount) %>). 
        Change if you received a different amount.
      </p>
    <% else %>
      <%= form.number_field :actual_amount, 
            step: "0.01", 
            min: "0",
            placeholder: "0.00",
            required: income_event.income_template_id.nil?,
            autofocus: income_event.income_template_id.nil?,
            class: "w-full px-4 py-3 pl-8 text-lg border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-full" %>
      <% if income_event.income_template_id.present? && income_event.actual_amount.to_f > 0 %>
        <p class="mt-1 text-sm text-gray-500">Update the received amount if it differs from what was originally recorded.</p>
      <% end %>
    <% end %>
  </div>
</div>

<div>
  <%= form.label :custom_label, class: "block text-sm font-medium text-gray-700 mb-2" do %>
    <%= label_text %> <span class="text-red-500"><%= required ? "*" : "" %></span>
  <% end %>
      <%= form.text_field :custom_label, 
            placeholder: placeholder_text,
            required: required,
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-full" %>
  <p class="mt-1 text-sm text-gray-500"><%= help_text %></p>
</div>

<div>
  <%= form.label :received_on, "Date Received", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.date_field :received_on, 
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-full" %>
</div>


<div>
  <%= form.label :notes, "Notes (optional)", class: "block text-sm font-medium text-gray-700 mb-2" %>
      <%= form.text_area :notes, 
            rows: 3,
            placeholder: "Optional notes about this income...",
            class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 max-w-full resize-y" %>
</div>

